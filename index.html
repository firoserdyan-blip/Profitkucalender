<!doctype html>

<html lang="id" data-theme="light">
<head>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6266746973368170"
     crossorigin="anonymous"></script>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ProfitKu: Aplikasi Kalender Profit Trading Harian Gratis</title>

<link rel="icon" type="image/png" href="logo.png" /> 
<link rel="manifest" href="manifest.json">

<meta property="og:url" content="https://firoserdyan-blip.github.io/" /> 
<meta property="og:title" content="ProfitKu: Kalender Profit Trading Harian Gratis" />
<meta property="og:description" content="Lupakan Excel yang rumit. Aplikasi web gratis untuk trader dan investor yang ingin melacak dan menganalisis performa profit dan kerugian harian dengan kalender interaktif. Tinjau performa trading Anda sekarang!" />
<meta property="og:image" content="https://firoserdyan-blip.github.io/logo.png" />

<script async src="https://www.googletagmanager.com/gtag/js?id=G-LZ7ZQJC86F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-LZ7ZQJC86F');
</script>


<style>
/* üé® KODE CSS FINAL */
:root{
    --bg:#f6f8fb;
    --card:#ffffff;
    --text:#0f172a;
    --muted:#6b7280;
    --accent:#2563eb;
    --green:#16a34a; 
    --red:#dc2626; 
    --input-bg:#ffffff;
    --input-border:rgba(15,23,42,0.12);
    --shadow:0 6px 18px rgba(15,23,42,0.06);
    --grid-bg:linear-gradient(180deg,#fff,#fbfdff);
}
[data-theme="dark"] {
    --bg:#1f2937;
    --card:#374151;
    --text:#f9fafb;
    --muted:#9ca3af;
    --accent:#60a5fa;
    --green:#4ade80; 
    --red:#f87171; 
    --input-bg:#4b5563;
    --input-border:rgba(255,255,255,0.15);
    --shadow:0 6px 18px rgba(0,0,0,0.3);
    --grid-bg:#374151; 
}

*{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
body{margin:0;background:var(--bg);color:var(--text);display:flex;align-items:center;justify-content:center;min-height:100vh;padding:15px;transition:background 0.3s, color 0.3s;}
.card{background:var(--card);padding:20px;border-radius:12px;box-shadow:var(--shadow);width:100%;max-width:400px;transition:background 0.3s, box-shadow 0.3s;}

/* --- CSS LOGO HEADER UTAMA --- */
.header-logo-group {
    display: flex; 
    align-items: center; 
    gap: 10px; 
}
.header-logo-img {
    width: 36px; 
    height: 36px;
    border-radius: 6px; 
    flex-shrink: 0; 
}
.header-logo-group h1 {
    margin: 0; 
    text-align: left; 
    font-size: 24px; 
}
h1{margin-top:0;text-align:center;color:var(--text);} 
/* ------------------------------------------------ */


input[type="email"]{width:100%;padding:10px;margin-top:10px;border-radius:8px;border:1px solid var(--input-border);box-sizing: border-box;background:var(--input-bg);color:var(--text);}

.password-container{position: relative;margin-top: 10px;}
.password-container input[type="password"], 
.password-container input[type="text"] { 
    width:100%;padding:10px 40px 10px 10px;border-radius:8px;border:1px solid var(--input-border);box-sizing: border-box;margin-top: 0;
    background:var(--input-bg);color:var(--text);
}
.password-toggle{position: absolute;right: 10px;top: 50%;transform: translateY(-50%);cursor: pointer;color: var(--muted);font-size: 18px;user-select: none;z-index: 10;}

button{width:100%;padding:10px;margin-top:14px;background:var(--accent);color:white;border:0;border-radius:8px;cursor:pointer;transition:background 0.2s;}
button:hover{filter:brightness(1.1);}

/* MODIFIKASI WRAP AGAR SELALU TERLIHAT */
.wrap{max-width:980px;margin:28px auto;padding:0 15px;width:100%;} 

header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;padding:0 5px;}

/* KONTROL HEADER BARU */
.controls{display:flex;gap:8px;align-items:center; flex-wrap: wrap;} 
.login-status-group {
    display: flex;
    align-items: center;
    gap: 10px;
}
/* STYLE BARU UNTUK PERINGATAN MERAH */
.login-alert {
    color: var(--red);
    font-weight: 600;
    font-size: 14px;
    line-height: 1.2;
    padding: 6px 8px;
    border-radius: 6px;
    border: 1px solid rgba(220, 38, 38, 0.2);
    background: rgba(220, 38, 38, 0.05);
    text-align: right;
}
[data-theme="dark"] .login-alert {
    background: rgba(220, 38, 38, 0.2);
}
/* --------------------------------- */

.calendar{
    margin-top:18px;display:flex;flex-direction:column;align-items:center;padding: 0 20px; box-sizing: border-box;width: 100%; 
}
.cal-header{display:flex;justify-content:space-between;align-items:center;width:100%;max-width:700px;flex-wrap:wrap;gap:10px;margin-bottom: 10px;}
.grid{
    display:grid;
    grid-template-columns:repeat(7,1fr);
    gap:4px;
    width:100%;
} 
.day{
    min-height: 55px; padding: 2px; border-radius: 8px;border: 1px solid rgba(15,23,42,0.04);
    background: var(--grid-bg);text-align: center;display: flex; 
    flex-direction: column;justify-content: center;align-items: center;font-size: 10px; 
    line-height: 1.1;cursor: pointer;overflow: hidden;white-space: normal;
    position: relative;
    transition: background 0.3s;
}
[data-theme="dark"] .day {
    border: 1px solid rgba(255,255,255,0.08); 
}
.day .date{font-size:10px;color:var(--muted)}

.day .note-indicator {
    position: absolute;
    top: 2px;
    right: 2px;
    font-size: 8px;
    color: var(--accent);
}

.amount{margin-top:1px;font-weight:600;font-size:11px;white-space: nowrap; color: var(--text);} 
.amount.loss { color: var(--red); } 
.amount.profit { color: var(--green); } 

.today{box-shadow:0 0 0 2px var(--accent);border:1px solid rgba(37,99,235,0.2);}

.summary{display:flex;gap:12px;margin-top:12px;flex-wrap:wrap;justify-content:center;width:100%;max-width:700px;}
.stat{
    flex:1;min-width:110px;background:var(--grid-bg);padding:10px; 
    border-radius:10px;text-align:center;box-shadow:0 2px 4px rgba(15,23,42,0.03);
    display: flex;flex-direction: column;justify-content: space-between; 
    transition: background 0.3s, box-shadow 0.3s;
}
[data-theme="dark"] .stat {
    box-shadow:0 2px 4px rgba(0,0,0,0.2);
}
.stat .value-display.loss {color: var(--red);} 
.stat .value-display.profit {color: var(--green);} 

.quick-action-bar{margin-top:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:center;width:100%;max-width:700px;}
input[type=date], select, input[type=text]{ 
    width:auto;padding:8px;border-radius:6px;border:1px solid var(--input-border);flex:1;
    background:var(--input-bg);color:var(--text); transition: background 0.3s, color 0.3s, border-color 0.3s;
}
#quickSave{width:auto;flex:none;margin-top:0;}

/* PERUBAHAN FOOTER */
.main-footer{margin-top:14px;color:var(--muted);font-size:13px;text-align:center;width:100%; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; padding-top: 10px; border-top: 1px solid var(--input-border); gap: 10px;}
.main-footer .footer-note { flex-grow: 1; text-align: left; }
.main-footer .footer-btn { flex-shrink: 0; margin: 0; }
/* -------------------- */

.actions{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    justify-content:flex-end;
    margin-top:0;
}
.btn{background:var(--accent);color:white;padding:8px 10px;border-radius:8px;border:0;cursor:pointer;white-space:nowrap; width: auto !important;}
.btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(37,99,235,0.12)}
.btn.danger{background:#dc2626; color:white; padding:8px 10px; border-radius:8px; border:0; cursor:pointer;} 

/* CSS untuk Modal (Editor, About) */
.modal-overlay {
    position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); 
    z-index:1000; align-items:center; justify-content:center;
    display: none; 
    padding: 15px;
}
[data-theme="dark"] .modal-overlay {
    background:rgba(0,0,0,0.8);
}
.modal-content-container {
    max-width: 300px;
    padding: 20px;
    background: var(--card);
    border-radius: 12px;
    box-shadow: var(--shadow);
    width: 100%;
    max-height: 90vh; 
    overflow-y: auto; 
}
.modal-content-container h3, .modal-content-container h4 {
    color: var(--accent);
}
.modal-content-container .logo-container {
    text-align: center;
    margin-bottom: 20px;
}
.modal-content-container .logo-container img {
    max-width: 80px; 
    height: auto;
    display: block;
    margin: 0 auto 10px; 
}

textarea {
    width: 100%;
    padding: 8px;
    margin-top: 10px;
    border-radius: 8px;
    border: 1px solid var(--input-border);
    background: var(--input-bg);
    color: var(--text);
    resize: vertical;
    min-height: 80px;
    box-sizing: border-box; 
}

.theme-toggle {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 10px;
    border-radius: 8px;
    background: var(--card);
    cursor: pointer;
    font-size: 14px;
    border: 1px solid var(--input-border);
    color: var(--text);
    transition: background 0.3s;
    width: auto;
    max-width: 110px; 
    justify-content: center;
}
.theme-toggle .icon {
    font-size: 16px;
}

@media (max-width: 500px){
    .calendar {margin-left: 0; right: 0; width: 100%;padding: 0 0;}
    .day {min-height: 50px;}
    
    header {
        flex-direction: row; 
        align-items: center; 
        justify-content: space-between;
    }
    
    .header-logo-group h1 {
        font-size: 20px;
    }
    .header-logo-img {
        width: 30px;
        height: 30px;
    }
    
    .controls {width: auto; justify-content: flex-end;}
    .login-status-group { flex-wrap: wrap; justify-content: flex-end; gap: 5px; }
    .login-alert { text-align: center; width: 100%; }
    
    .summary {max-width: none;}
    .stat {min-width: 100%;}
    .quick-action-bar input, .quick-action-bar button, .quick-action-bar select {flex: 1 1 45%;}
    #quickSave {flex: 1 1 100%; margin-top: 5px;}
    
    .cal-header .actions {
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        width: 100%;
        gap: 8px; 
        margin-top: 8px; 
        justify-content: space-between;
    }
    .cal-header .actions > * {
        margin-top: 0 !important; 
        width: 100% !important; 
        box-sizing: border-box;
    }
    .cal-header .actions #resetDataBtn {
        grid-column: span 2; 
    }
    
    #weekdayHeader .muted.small {
        font-size: 10px; 
        font-weight: 600; 
    }
    
    .main-footer {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    .main-footer .footer-note { text-align: center; }
}
</style>
</head>
<body>
<div class="wrap" id="app">
    <header>
        <div class="header-logo-group">
            <img src="logo.png" alt="ProfitKu" class="header-logo-img" /> <div>
                <h1>Profit Calendar</h1>
                <div class="muted small">Aplikasi Gratis untuk Trader & Investor</div>
            </div>
        </div>
        
        <div class="controls">
            <div class="login-alert">Data tersimpan di perangkat Anda (Lokal)</div>
            <div class="theme-toggle" id="themeToggle" style="margin-top:0;">
                <span class="icon">‚òÄÔ∏è</span> <span id="themeLabel">Terang</span>
            </div>
        </div>
    </header>
    <div class="card calendar">
        <div class="cal-header" style="display:flex;justify-content:space-between;align-items:center;width:100%;max-width:700px;flex-wrap:wrap;gap:10px">
            
            <div style="display:flex;align-items:center;gap:12px">
                <button class="nav-btn" id="prev">‚óÄ</button>
                <div style="font-weight:600" id="monthLabel">‚Äî</div>
                <button class="nav-btn" id="next">‚ñ∂</button>
            </div>

            <div class="actions">
                <select id="currencySelect" style="margin-top:0; max-width: 100px;">
                    <option value="IDR">IDR (Rp)</option>
                    <option value="USD">USD ($)</option>
                    <option value="EUR">EUR (‚Ç¨)</option>
                    <option value="JPY">JPY (¬•)</option>
                    <option value="BTC">BTC (‚Çø)</option>
                </select>
                <button class="btn" id="todayBtn" style="margin-top:0;">Hari Ini</button>
                <button class="btn export" id="exportCsv" style="margin-top:0;">Export CSV</button>
                <button class="btn danger" id="resetDataBtn" style="margin-top:0; background-color: var(--red);">Reset Data Mata Uang Aktif</button> 
            </div>
            
        </div>
        
        <div class="grid" id="weekdayHeader">
        </div>
        
        <div class="grid" id="calendarGrid"></div>
        <div class="summary">
            <div class="stat">
                <div class="small muted">Total (month)</div>
                <div style="font-size:18px" id="monthTotal" class="value-display">$0</div>
            </div>
            <div class="stat">
                <div class="small muted">Avg per hari data</div>
                <div style="font-size:18px" id="avgDay" class="value-display">$0</div>
            </div>
            <div class="stat">
                <div style="font-size:13px" class="small muted"># Days Recorded</div>
                <div style="font-size:18px" id="daysCount">0</div>
            </div>
        </div>
        
        <div class="quick-action-bar">
            <input type="date" id="quickDate" />
            <input type="text" id="quickAmt" inputmode="decimal" placeholder="Profit (boleh negatif, cth: 500.000 atau 10,50)" /> 
            <button class="btn" id="quickSave">Simpan</button>
        </div>
        
        <div class="main-footer">
            <div class="footer-note">Data tersimpan di perangkat Anda (Local Storage), data tidak masuk ke server kami.</div>
            <div style="display:flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end;">
                <a href="privacy-policy.html" target="_blank" class="btn ghost footer-btn" style="color: var(--text); border: 1px solid var(--input-border); margin-top: 0;">Privacy Policy</a>
                <button class="btn ghost footer-btn" id="showAboutModalBtn" style="color: var(--text); border: 1px solid var(--input-border); margin-top: 0;">Tentang Website & Fitur</button>
            </div>
        </div>
        </div>
</div>

<div id="editorModal" style="display:none;" class="modal-overlay">
    <div class="modal-content-container">
        <h3 id="editorTitle">Edit Data</h3>
        
        <div style="margin-bottom: 15px;">
            <div class="muted small" style="margin-bottom: 5px;">Jumlah Profit / Loss:</div>
            <input type="text" id="editorAmt" inputmode="decimal" placeholder="Profit (cth: 500.000 atau 10,50)" style="width: 100%;">
        </div>
        
        <div style="margin-bottom: 15px;">
            <div class="muted small" style="margin-bottom: 5px;">Catatan/Deskripsi Harian:</div>
            <textarea id="editorNote" placeholder="Tulis catatan harian (misal: 'Profit dari investasi saham A' atau 'Loss karena entry telat')"></textarea>
        </div>
        
        <div style="display:flex; gap:10px; margin-top:15px;">
            <button class="btn ghost" id="closeEditorBtn" style="flex:1; margin-top:0;">Batal</button>
            <button class="btn" id="saveEditorBtn" style="flex:1; margin-top:0;">Simpan</button>
        </div>
        <button class="btn ghost" id="deleteEditorBtn" style="background:transparent; color:#dc2626; border:1px solid rgba(220,38,38,0.3); margin-top:10px;">Hapus Data</button>
    </div>
</div>
<div id="aboutModal" style="display:none;" class="modal-overlay">
    <div class="modal-content-container" style="max-width: 600px;">
        <h3 style="margin-top: 0; color: var(--accent);">ProfitKu: Aplikasi Kalender Profit & Loss Harian</h3>
        
        <p style="font-size: 14px; color: var(--text);">Selamat datang di ProfitKu, aplikasi web (Single Page Application) yang dirancang untuk membantu trader, investor, dan pelaku bisnis online melacak riwayat keuangan harian mereka dengan mudah. Kami mengatasi masalah lupa mencatat profit/loss harian dari berbagai sumber seperti trading saham, crypto, forex, atau bisnis online dengan sistem kalender yang efisien.</p>
        
        <p style="font-size: 14px; color: var(--red); font-weight: 600;">PENTING: Aplikasi ini TIDAK memiliki fitur Login/Daftar. Semua data yang Anda masukkan disimpan secara lokal di perangkat Anda (Local Storage) dan TIDAK dikirim ke server mana pun.</p>

        <h4 style="margin-bottom: 8px; color: var(--text); margin-top: 20px;">Fitur Utama ProfitKu:</h4>
        <ul style="font-size: 14px; color: var(--muted); padding-left: 20px; margin-top: 5px; list-style-type: square;">
            <li>‚úÖ **Pencatatan Harian:** Masukkan jumlah profit atau kerugian (bisa negatif) untuk setiap hari.</li>
            <li>‚úÖ **Dukungan Multi-Mata Uang:** Catat profit dalam IDR, USD, EUR, JPY, hingga Bitcoin (‚Çø).</li>
            <li>‚úÖ **Ringkasan Otomatis:** Dapatkan total profit bulanan dan rata-rata profit per hari secara otomatis.</li>
            <li>‚úÖ **Catatan Harian:** Tambahkan deskripsi singkat pada setiap entri kalender.</li>
            <li>‚úÖ **Ekspor Data:** Export semua data profit Anda ke file CSV kapan saja.</li>
            <li>‚úÖ **Data Aman (Lokal):** Data disimpan hanya di perangkat Anda sendiri.</li>
        </ul>

        <h4 style="margin-bottom: 8px; color: var(--text); margin-top: 20px;">FAQ (Pertanyaan Umum)</h4>
        <p style="font-size: 14px; color: var(--muted); margin-bottom: 5px;">**Apakah data saya aman?**</p>
        <p style="font-size: 14px; color: var(--text); margin-top: 0;">Ya. Data Anda disimpan secara lokal (Local Storage) di *browser* perangkat Anda. Kami tidak memiliki akses ke data tersebut. Namun, jika Anda menghapus *cache* atau menggunakan *browser* yang berbeda, data Anda bisa hilang.</p>
        
        <p style="font-size: 14px; color: var(--muted); margin-bottom: 5px;">**Apakah aplikasi ini gratis?**</p>
        <p style="font-size: 14px; color: var(--text); margin-top: 0;">Ya, ProfitKu sepenuhnya gratis. Kami menggunakan AdSense untuk menutupi biaya hosting.</p>
        
        <button class="btn" id="closeAboutModalBtn" style="margin-top: 20px; width: 100%;">Tutup</button>
    </div>
</div>
<script>
// üíæ KODE JAVASCRIPT HANYA MENGGUNAKAN LOCAL STORAGE
document.addEventListener('DOMContentLoaded', () => {
    
    const LOCAL_STORAGE_KEY = 'profitku_v2_data';

    const CURRENCY_SYMBOLS = {
        'USD': '$', 'IDR': 'Rp', 'EUR': '‚Ç¨', 'JPY': '¬•', 'BTC': '‚Çø',
    };
    
    // Structure: { currentCurrency: 'IDR', allEntries: { 'IDR': { '2025-10-21': { amount: 100, note: '...' } } } }
    let data = loadData(); 
    
    const html = document.documentElement; 
    
    // Elemen Header/Controls
    const currencySelect = document.getElementById('currencySelect'); 
    const resetDataBtn = document.getElementById('resetDataBtn');

    // Elemen Quick Action
    const quickDate = document.getElementById('quickDate');
    const quickAmt = document.getElementById('quickAmt');
    const quickSave = document.getElementById('quickSave');

    // Elemen Modals
    const editorModal = document.getElementById('editorModal');
    const editorTitle = document.getElementById('editorTitle');
    const editorAmtInput = document.getElementById('editorAmt');
    const editorNoteInput = document.getElementById('editorNote'); 
    const aboutModal = document.getElementById('aboutModal');
    
    // Elemen Tema
    const themeToggle = document.getElementById('themeToggle');
    const themeLabel = document.getElementById('themeLabel');
    const themeIcon = themeToggle ? themeToggle.querySelector('.icon') : null;

    let editingYMD = null; 
    const today = new Date();
    let viewYear = today.getFullYear();
    let viewMonth = today.getMonth();

    function formatYMD(y,m,d){ 
        const mm=String(m+1).padStart(2,'0'); 
        const dd=String(d).padStart(2,'0'); 
        return `${y}-${mm}-${dd}`; 
    }
    
    function getCurrentEntries() {
        return data.allEntries[data.currentCurrency] || {};
    }
    
    // FUNGSI LOAD DATA (LOCAL STORAGE)
    function loadData(){ 
        try {
            const stored = localStorage.getItem(LOCAL_STORAGE_KEY);
            let loadedData = stored ? JSON.parse(stored) : { allEntries: {}, currentCurrency: 'IDR' };
            
            // Cleanup: Pastikan structure selalu benar
            if (!loadedData.allEntries) loadedData.allEntries = {};
            if (!loadedData.currentCurrency) loadedData.currentCurrency = 'IDR';

            // Migrate old structure if needed (for simplicity, we assume entries are already structured correctly or will be fixed on save)
            
            return loadedData;

        } catch (error) {
            console.error("Error loading data from Local Storage:", error);
            return { allEntries: {}, currentCurrency: 'IDR' }; 
        }
    }

    // FUNGSI SAVE DATA (LOCAL STORAGE)
    function saveData(){ 
        try {
            // Clean up empty entries before saving
            const entriesToSave = {};
            for (const currency in data.allEntries) {
                const cleanedCurrencyEntries = {};
                for (const ymd in data.allEntries[currency]) {
                    const entry = data.allEntries[currency][ymd];
                    const amount = Number(entry.amount); 
                    
                    if (amount !== 0 || entry.note.trim() !== '') {
                         cleanedCurrencyEntries[ymd] = { amount: amount, note: entry.note };
                    }
                }
                if (Object.keys(cleanedCurrencyEntries).length > 0) {
                     entriesToSave[currency] = cleanedCurrencyEntries;
                }
            }
            
            data.allEntries = entriesToSave;

            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data));
        } catch (error) {
            console.error("Error saving data to Local Storage:", error);
            alert("Gagal menyimpan data ke perangkat Anda.");
        }
    }
    
    function resetCurrentCurrencyData() {
        const currentCurrency = data.currentCurrency;
        
        const confirm1 = confirm(`PERINGATAN! Tindakan ini akan menghapus SEMUA data profit/loss Anda untuk mata uang ${currentCurrency} yang tersimpan di perangkat ini.\n\nApakah Anda YAKIN ingin melanjutkan?`);
        
        if (!confirm1) {
            return; 
        }

        const confirm2 = confirm(`PERINGATAN AKHIR! Semua data ${currentCurrency} Anda akan hilang PERMANEN dari perangkat ini. Pastikan Anda sudah meng-Export CSV.\n\nTekan OK untuk menghapus SEMUA DATA ${currentCurrency}.`);

        if (confirm2) {
            delete data.allEntries[currentCurrency];
            saveData();
            alert(`Data ${currentCurrency} berhasil direset dari Local Storage.`);
            renderCalendar(); 
        }
    }

    function formatCurrency(amount, currencyCode) {
        const symbol = CURRENCY_SYMBOLS[currencyCode] || '$';
        const isLoss = amount < 0;
        const isProfit = amount > 0;
        
        let displayAmount;
        
        if (currencyCode === 'IDR') {
             const decimalOptions = { minimumFractionDigits: 0, maximumFractionDigits: 2 };
             displayAmount = Math.abs(amount).toLocaleString('id-ID', decimalOptions); 
        } else {
            displayAmount = Math.abs(amount).toFixed(2);
        }
        
        const absoluteDisplayAmount = displayAmount.replace('-', '');
        let formattedString;

        if (currencyCode === 'IDR') {
            formattedString = (isLoss ? `-${symbol}${absoluteDisplayAmount}` : `${symbol}${absoluteDisplayAmount}`);
        } 
        else if (currencyCode === 'BTC') {
            formattedString = (isLoss ? `-${symbol} ${absoluteDisplayAmount}` : `${symbol} ${absoluteDisplayAmount}`);
        }
        else {
            formattedString = (isLoss ? `-${symbol}${absoluteDisplayAmount}` : `${symbol}${absoluteDisplayAmount}`);
        }

        if (isLoss) {
            return `<span style="color: var(--red);">${formattedString}</span>`;
        } else if (isProfit) {
            return `<span style="color: var(--green);">${formattedString}</span>`;
        } else {
            return formattedString;
        }
    }
    
    function applyTheme(theme) {
        html.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        if (themeLabel) themeLabel.textContent = theme === 'dark' ? 'Gelap' : 'Terang';
        if (themeIcon) themeIcon.innerHTML = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    }

    const storedTheme = localStorage.getItem('theme') || 'light';
    applyTheme(storedTheme); 

    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
        });
    }

    function renderWeekdayHeader() {
        const weekdayHeader = document.getElementById('weekdayHeader');
        if (!weekdayHeader) return;
        weekdayHeader.innerHTML = ''; 

        const userLocale = navigator.language || navigator.userLanguage || 'id-ID'; 
        const formatter = new Intl.DateTimeFormat(userLocale, { weekday: 'short' });

        const today = new Date();
        const startDay = today.getDate() - today.getDay(); 
        
        for (let i = 0; i < 7; i++) {
            const date = new Date(today.setDate(startDay + i));
            let dayName = formatter.format(date);
            
            const dayDiv = document.createElement('div');
            dayDiv.className = 'day muted small';
            dayDiv.textContent = dayName.charAt(0).toUpperCase() + dayName.slice(1);
            weekdayHeader.appendChild(dayDiv);
        }
        
        document.getElementById('monthLabel').textContent = new Date(viewYear,viewMonth,1).toLocaleString(userLocale, {month:'long'})+' '+viewYear;
    }
    
    // --- RENDER CALENDAR ---
    function renderCalendar(){
      const grid = document.getElementById('calendarGrid'); 
      if(!grid) return; 

      const currentEntries = getCurrentEntries(); 
      const currentCurrency = data.currentCurrency;
      
      grid.innerHTML='';
      renderWeekdayHeader(); 

      const firstDay = new Date(viewYear,viewMonth,1).getDay();
      const daysInMonth = new Date(viewYear,viewMonth+1,0).getDate();
      for(let i=0;i<firstDay;i++){
        const emptyCell = document.createElement('div');
        emptyCell.className='day'; grid.appendChild(emptyCell);
      }
      for(let d=1;d<=daysInMonth;d++){
        const ymd = formatYMD(viewYear,viewMonth,d);
        
        const entry = currentEntries[ymd] || { amount: 0, note: '' }; 
        const amt = entry.amount;
        const note = entry.note;
        
        const cell = document.createElement('div'); 
        cell.className='day card-item';
        
        if(ymd===formatYMD(today.getFullYear(),today.getMonth(),today.getDate())) cell.classList.add('today');
        
        const amountDisplay = formatCurrency(amt, currentCurrency); 
        const lossClass = amt < 0 ? ' loss' : (amt > 0 ? ' profit' : '');
        
        let noteIndicator = note.trim() !== '' ? '<span class="note-indicator">üìù</span>' : '';

        cell.innerHTML=`
            <div class="date">${d}</div>
            ${noteIndicator}
            <div class="amount${lossClass}" data-date="${ymd}">${amountDisplay}</div>
        `;
        
        cell.addEventListener('click',()=> openEditor(ymd,amt, note));
        grid.appendChild(cell);
      }
      updateSummary();
    }
    
    function openEditor(ymd, amt, note) {
      if (!editorModal) return;
      editingYMD = ymd;
      
      editorTitle.textContent = `Edit Data ${ymd} (${data.currentCurrency})`; 
      
      editorAmtInput.value = amt === 0 ? '' : String(amt); 
      editorNoteInput.value = note || ''; 
      editorModal.style.display = 'flex'; 
      editorAmtInput.focus();
    }
    
    function closeEditor() {
      if (editorModal) editorModal.style.display = 'none'; 
      editingYMD = null;
    }
    
    function parseInput(inputString, currency) {
        let cleanString = inputString.trim();

        if (cleanString === '') {
            return 0;
        }

        cleanString = cleanString.replace(/[^\d,\.\-]/g, '');

        if (currency === 'IDR') {
            cleanString = cleanString.replace(/\./g, '');
            cleanString = cleanString.replace(/,/g, '.');
        } else {
            cleanString = cleanString.replace(/,/g, '.');
        }

        const num = Number(cleanString);
        
        if (isNaN(num)) {
            return null;
        }
        return num;
    }

    function updateSummary(){
        const monthTotalEl = document.getElementById('monthTotal');
        const avgDayEl = document.getElementById('avgDay');
        const daysCountEl = document.getElementById('daysCount');
        
        if (!monthTotalEl || !avgDayEl || !daysCountEl || !quickAmt) return;
        
        const currentEntries = getCurrentEntries();
        const currentCurrency = data.currentCurrency;
        const monthKeyPrefix = `${viewYear}-${String(viewMonth+1).padStart(2,'0')}-`;
        let total=0,count=0;
        
        for(const k in currentEntries){ 
            if(k.startsWith(monthKeyPrefix)){ 
                const entry = currentEntries[k];
                const amount = Number(entry.amount || 0); 
                total += amount; 
                if(amount !== 0 || entry.note.trim() !== '') count++; 
            }
        }
        
        const totalDisplay = formatCurrency(total, currentCurrency);
        monthTotalEl.innerHTML = totalDisplay.replace(/<span style="color: var\(--(red|green)\);">/g, '').replace(/<\/span>/g, '');
        
        monthTotalEl.classList.remove('loss', 'profit');
        if (total < 0) {
            monthTotalEl.classList.add('loss'); 
        } else if (total > 0) {
            monthTotalEl.classList.add('profit');
        }
        
        const avgDay = count ? (total / count) : 0;
        const avgDisplay = formatCurrency(avgDay, currentCurrency);
        avgDayEl.innerHTML = avgDisplay.replace(/<span style="color: var\(--(red|green)\);">/g, '').replace(/<\/span>/g, '');
        
        avgDayEl.classList.remove('loss', 'profit');
        if (avgDay < 0) {
            avgDayEl.classList.add('loss');
        } else if (avgDay > 0) {
            avgDayEl.classList.add('profit');
        }
        
        daysCountEl.textContent = count;
        quickAmt.placeholder = `Profit ${currentCurrency} (cth: 500.000 atau 10,50)`;
    }
    
    // --- ABOUT MODAL HANDLERS ---
    document.getElementById('showAboutModalBtn').addEventListener('click', () => {
        if(aboutModal) aboutModal.style.display = 'flex';
    });
    
    document.getElementById('closeAboutModalBtn').addEventListener('click', () => {
        if(aboutModal) aboutModal.style.display = 'none';
    });
    
    // --- NAVIGASI DAN QUICK SAVE ---
    const prevBtn = document.getElementById('prev');
    if(prevBtn) prevBtn.addEventListener('click',()=>{ viewMonth--; if(viewMonth<0){viewMonth=11;viewYear--;} renderCalendar(); });
    
    const nextBtn = document.getElementById('next');
    if(nextBtn) nextBtn.addEventListener('click',()=>{ viewMonth++; if(viewMonth>11){viewMonth=0;viewYear++;} renderCalendar(); });
    
    const todayBtn = document.getElementById('todayBtn');
    if(todayBtn) todayBtn.addEventListener('click',()=>{ viewYear=today.getFullYear(); viewMonth=today.getMonth(); renderCalendar(); });

    // --- LOGIKA QUICK SAVE ---
    if(quickSave) quickSave.addEventListener('click', async ()=>{
      
      if(!quickDate) return; 
      const d = quickDate.value;
      const a = quickAmt.value;
      if(!d){ alert('Pilih tanggal'); return; }
      
      const currentCurrency = data.currentCurrency;
      const num = parseInput(a, currentCurrency); 
      
      if(num === null){ alert(`Masukkan angka profit yang valid untuk ${currentCurrency}! (Contoh: 500.000 atau 10,50)`); return; }
      
      if (!data.allEntries[currentCurrency]) {
          data.allEntries[currentCurrency] = {};
      }

      data.allEntries[currentCurrency][d] = { amount: num, note: '' }; 
      
      saveData(); 
      renderCalendar();
      quickAmt.value='';
    });
    
    // --- EDITOR MODAL HANDLERS ---
    if(saveEditorBtn) saveEditorBtn.addEventListener('click', () => {
      
      if (!editingYMD) return; 
      const n = editorAmtInput.value.trim();
      const noteText = editorNoteInput.value.trim(); 
      const currentCurrency = data.currentCurrency;
      
      const num = parseInput(n, currentCurrency);

      if (num === null) {
          alert(`Masukkan angka profit yang valid untuk ${currentCurrency}!`);
          return;
      }
      
      const finalNum = num; 
      
      if (!data.allEntries[currentCurrency]) {
          data.allEntries[currentCurrency] = {};
      }
      
      if (finalNum === 0 && noteText === '') {
          // If amount is 0 and note is empty, delete entry
          delete data.allEntries[currentCurrency][editingYMD];
      } else {
          data.allEntries[currentCurrency][editingYMD] = { amount: finalNum, note: noteText };
      }
      
      closeEditor();
      saveData(); 
      renderCalendar();
    });

    const closeEditorBtn = document.getElementById('closeEditorBtn');
    if(closeEditorBtn) closeEditorBtn.addEventListener('click', closeEditor);
    
    if(deleteEditorBtn) deleteEditorBtn.addEventListener('click', () => {
      
      const currentCurrency = data.currentCurrency;
      if(confirm(`Yakin hapus data hari ${editingYMD} (${currentCurrency})? (Profit & Catatan)`)){
          delete data.allEntries[currentCurrency][editingYMD];
          closeEditor();
          saveData(); 
          renderCalendar();
      }
    });
    
    // --- HANDLER: RESET DATA MATA UANG AKTIF ---
    if(resetDataBtn) resetDataBtn.addEventListener('click', () => {
        resetCurrentCurrencyData();
    });

    // --- CURRENCY CHANGE ---
    if(currencySelect) currencySelect.addEventListener('change', (e) => {
        data.currentCurrency = e.target.value; 
        saveData(); 
        renderCalendar();
    });

    // --- EXPORT CSV DENGAN SEMUA MATA UANG ---
    const exportCsv = document.getElementById('exportCsv');
    if(exportCsv) exportCsv.addEventListener('click', ()=>{
        const rows=[['date','profit_amount', 'currency', 'note']]; 
        let totalProfitPerCurrency = {};
        
        for (const currency in data.allEntries) {
            const currencyEntries = data.allEntries[currency];
            
            for(const k of Object.keys(currencyEntries).sort()) {
                const entry = currencyEntries[k];
                const amount = entry.amount || 0;
                const note = entry.note.replace(/,/g, ';').replace(/\n/g, ' '); 
                
                rows.push([k, String(amount), currency, note]); 
                
                totalProfitPerCurrency[currency] = (totalProfitPerCurrency[currency] || 0) + amount;
            }
        }
        
        rows.push(['---', '---', '---', '---']); 
        for (const currency of Object.keys(totalProfitPerCurrency).sort()) {
            const total = totalProfitPerCurrency[currency];
            const totalLabel = (total < 0) ? `Total Loss (${currency})` : `Total Profit (${currency})`;
            const displayTotal = total.toFixed(2);
            rows.push([totalLabel, String(displayTotal), currency, '']);
        }
        
        const csv=rows.map(r=>r.join(',')).join('\n');
        const blob=new Blob([csv],{type:'text/csv'});
        const url=URL.createObjectURL(blob);
        
        const a=document.createElement('a'); a.href=url; a.download=`profit_calendar_multi_currency_export.csv`; a.click(); URL.revokeObjectURL(url);
    });

    if(quickDate) quickDate.value = formatYMD(today.getFullYear(),today.getMonth(),today.getDate());
    
    // Load initial currency selection
    if(currencySelect) currencySelect.value = data.currentCurrency;
    
    renderCalendar(); 
});
</script>
</body>
</html>
